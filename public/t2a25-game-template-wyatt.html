<script>

let lastDirection = "right"
let bulletActive = false
let bulletTimer = null
let myScore = 10


// =======================
// COLLISION
// =======================
function hit(a, b){
   let A = document.getElementById(a).getBoundingClientRect()
   let B = document.getElementById(b).getBoundingClientRect()

   return !(
      A.right < B.left ||
      A.left > B.right ||
      A.bottom < B.top ||
      A.top > B.bottom
   )
}


// =======================
// SHOOTING
// =======================
function fireBullet(){

   // Only 1 bullet at a time
   if (bulletActive) return  
   bulletActive = true

   let b = document.getElementById("myBullet")
   let g = document.getElementById("myImg01")

   // Spawn bullet at center of player
   let gx = parseInt(g.style.left)
   let gy = parseInt(g.style.top)

   b.style.left = (gx + 45) + "px"
   b.style.top  = (gy + 35) + "px"
   b.style.display = "block"

   clearInterval(bulletTimer)

   bulletTimer = setInterval(function(){

      let bx = parseInt(b.style.left)
      let by = parseInt(b.style.top)

      // Move based on last direction
      if (lastDirection == "right") bx += 10
      if (lastDirection == "left")  bx -= 10
      if (lastDirection == "up")    by -= 10
      if (lastDirection == "down")  by += 10

      b.style.left = bx + "px"
      b.style.top = by + "px"

      // Check zombie hits
      if (hit("myBullet","myImg02")){
         document.all.myText01.value = "You shot Zombie1!"
         resetBullet()
      }

      if (hit("myBullet","myImg03")){
         document.all.myText01.value = "You shot Zombie2!"
         resetBullet()
      }

      // Off screen? delete bullet
      if (bx < -20 || bx > 1200 || by < -20 || by > 800){
         resetBullet()
      }

   }, 20)
}


// =======================
// DELETE BULLET
// =======================
function resetBullet(){
   clearInterval(bulletTimer)
   let b = document.getElementById("myBullet")
   b.style.left = "-200px"
   b.style.top = "-200px"
   b.style.display = "none"
   bulletActive = false
}


// =======================
// MOVEMENT
// =======================
function moveUp(){
   lastDirection = "up"
   let g = document.getElementById("myImg01")
   g.style.top = parseInt(g.style.top) - 10 + "px"
}

function moveDown(){
   lastDirection = "down"
   let g = document.getElementById("myImg01")
   g.style.top = parseInt(g.style.top) + 10 + "px"
}

function moveLeft(){
   lastDirection = "left"
   let g = document.getElementById("myImg01")
   g.style.left = parseInt(g.style.left) - 10 + "px"
}

function moveRight(){
   lastDirection = "right"
   let g = document.getElementById("myImg01")
   g.style.left = parseInt(g.style.left) + 10 + "px"
}

</script>



<body onkeydown="{
   if(event.key=='w') moveUp()
   if(event.key=='s') moveDown()
   if(event.key=='a') moveLeft()
   if(event.key=='d') moveRight()
}">

<input id="myText01" type=text size=40><br><br>

<!-- MOVE BUTTONS -->
<button onclick="moveUp()">W</button><br>
<button onclick="moveLeft()">A</button>
<button onclick="moveDown()">S</button>
<button onclick="moveRight()">D</button><br><br>

<button onclick="fireBullet()">SHOOT</button><br><br>


<!-- PLAYER -->
<img id="myImg01" src="olddudewitgun.gif"
     style="position:absolute; width:100px; height:80px; left:50px; top:200px;">


<!-- ZOMBIES -->
<img id="myImg02" src="Zombie1.gif"
     style="position:absolute; width:100px; height:80px; left:350px; top:190px;">

<img id="myImg03" src="Zombie2.gif"
     style="position:absolute; width:100px; height:80px; left:500px; top:190px;">


<!-- EXIT DOOR (YOU ASKED FOR IT BACK) -->
<img id="myImg04" src="Exitdoor.gif"
     style="position:absolute; width:100px; height:80px; left:500px; top:400px;">


<!-- SINGLE BULLET -->
<img id="myBullet" src="Bullet1.gif"
     style="position:absolute; width:10px; height:10px; left:-200px; top:-200px; display:none; z-index:9999;">


</body>
