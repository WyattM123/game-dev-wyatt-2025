<h1>t2-final-level2-wyatt.html</h1>
<b style="color:green; background-color:darkgreen;">Objective: Grab ammo, kill the zombies, and save the civilian</b>

<script>

let myGlobalX = 0
let myClock
let myScore = 10
let lastDirection = "right"

let canShoot = true
let shootCooldown = 400
let bullets = []

var zombie1HP = 2
var zombie2HP = 2

let playerHP = 10
let canTakeDamage = true

let ammo = 2
let maxAmmo = 24

function updateHealthDisplay(){
   document.getElementById("healthDisplay").innerHTML = "Health: " + playerHP
}

function updateAmmoDisplay(){
   document.getElementById("ammoDisplay").innerHTML = "Ammo: " + ammo + " / " + maxAmmo
}

function playerTakeDamage(){
   if (!canTakeDamage) return

   playerHP -= 1
   updateHealthDisplay()
   canTakeDamage = false

   let r = document.getElementById("myImg01").getBoundingClientRect()
   spawnHitParticle(r.left + 40, r.top + 30)

   setTimeout(function(){
      canTakeDamage = true
   }, 1000)

   if (playerHP <= 0){
      alert("Game Over")
      location.reload()
   }
}

function myHitOther(el1, el2){
   let A = el1.getBoundingClientRect()
   let B = el2.getBoundingClientRect()
   return !(
      A.right < B.left ||
      A.left > B.right ||
      A.bottom < B.top ||
      A.top > B.bottom
   )
}

function spawnHitParticle(x,y){
   let p = document.createElement("div")
   p.style.position = "absolute"
   p.style.left = x + "px"
   p.style.top  = y + "px"
   p.style.width = "20px"
   p.style.height = "20px"
   p.style.background = "red"
   p.style.borderRadius = "50%"
   p.style.opacity = "1"
   p.style.zIndex = 9999
   p.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out"
   document.body.appendChild(p)

   setTimeout(function(){
      p.style.opacity = "0"
      p.style.transform = "scale(2)"
   }, 10)

   setTimeout(function(){
      p.remove()
   }, 450)
}

function checkExitDoor(){
   let zombie2Alive = document.getElementById('myImg02').style.display != "none";
   let zombie3Alive = document.getElementById('myImg03').style.display != "none";

   if (myHitOther(document.getElementById('myImg01'), document.getElementById('myImg04'))) {
       if (!zombie2Alive && !zombie3Alive) {
           document.all.myText01.value = "Made it out... For now";
           alert("Next level");
           location = "t2-final-level3-wyatt.html";
       } else {
           document.all.myText01.value = "Complete the objective before skedaddling";
       }
   }
}


function hitZombie(zombieID, hpVarName){
   let z = document.getElementById(zombieID)
   let rect = z.getBoundingClientRect()
   spawnHitParticle(rect.left + 40, rect.top + 30)

   window[hpVarName] -= 1

   if (window[hpVarName] <= 0){
      z.style.display = "none"
      document.all.myText01.value = zombieID + " shot dead"
   } else {
      document.all.myText01.value = zombieID + " shot"
   }
}

function fireBullet() {
    if (!canShoot || ammo <= 0) return;

    ammo -= 1;
    updateAmmoDisplay();

    canShoot = false;
    setTimeout(() => canShoot = true, shootCooldown);

    let b = document.createElement("div");
    b.style.position = "absolute";
    b.style.width = "12px";
    b.style.height = "12px";
    b.style.background = "yellow";
    b.style.zIndex = 9999;

    let g = document.getElementById('myImg01');
    let gx = parseInt(g.style.left)
    let gy = parseInt(g.style.top)

    b.style.left = gx + 45 + "px";
    b.style.top  = gy + 35 + "px";

    document.body.appendChild(b);

    let dx = 0, dy = 0;
    if (lastDirection == "right") dx = 10;
    if (lastDirection == "left")  dx = -10;
    if (lastDirection == "up")    dy = -10;
    if (lastDirection == "down")  dy = 10;

    let bulletObj = {el: b, dx: dx, dy: dy, interval: null};

    bulletObj.interval = setInterval(() => {
        let bx = parseInt(b.style.left) + bulletObj.dx;
        let by = parseInt(b.style.top) + bulletObj.dy;
        b.style.left = bx + "px";
        b.style.top  = by + "px";

        if (document.getElementById('myImg02').style.display != "none" && myHitOther(b, document.getElementById('myImg02'))) {
            hitZombie("myImg02", "zombie1HP");
            removeBullet(bulletObj);
        }

        if (document.getElementById('myImg03').style.display != "none" && myHitOther(b, document.getElementById('myImg03'))) {
            hitZombie("myImg03", "zombie2HP");
            removeBullet(bulletObj);
        }

        if (bx < -20 || bx > 2000 || by < -20 || by > 2000) {
            removeBullet(bulletObj);
        }
    }, 20);

    bullets.push(bulletObj);
}

function removeBullet(bulletObj) {
    clearInterval(bulletObj.interval);
    bulletObj.el.remove();
    bullets = bullets.filter(b => b !== bulletObj);
}

function randomizeZombiePositions(){
   let minX = 200, maxX = 800
   let minY = 100, maxY = 400

   ;["myImg02","myImg03"].forEach(id=>{
      let z = document.getElementById(id)
      z.style.left = Math.random()*(maxX-minX)+minX+"px"
      z.style.top  = Math.random()*(maxY-minY)+minY+"px"
   })
}

function checkAmmoPickup(){
   let a = document.getElementById("myImg05")
   if (a.style.display !== "none" && myHitOther(document.getElementById("myImg01"),a)){
      ammo = Math.min(ammo + 6, maxAmmo)
      updateAmmoDisplay()
      a.style.display = "none"
      document.all.myText01.value = "Picked up ammo!"
   }
}

function moveScaredGuy() {
    let guy = document.getElementById("myImg06");
    let zx1 = parseFloat(document.getElementById("myImg02").style.left);
    let zy1 = parseFloat(document.getElementById("myImg02").style.top);
    let zx2 = parseFloat(document.getElementById("myImg03").style.left);
    let zy2 = parseFloat(document.getElementById("myImg03").style.top);
    
    let gx = parseFloat(guy.style.left);
    let gy = parseFloat(guy.style.top);

    let dx = (Math.random() - 0.5) * 4;
    let dy = (Math.random() - 0.5) * 4;

    if (document.getElementById("myImg02").style.display != "none") {
        let diffX = gx - zx1;
        let diffY = gy - zy1;
        let dist = Math.sqrt(diffX*diffX + diffY*diffY);
        if (dist < 200) {  // if zombie too close
            dx += diffX / dist * 3; // run away faster
            dy += diffY / dist * 3;
        }
    }
    if (document.getElementById("myImg03").style.display != "none") {
        let diffX = gx - zx2;
        let diffY = gy - zy2;
        let dist = Math.sqrt(diffX*diffX + diffY*diffY);
        if (dist < 200) {
            dx += diffX / dist * 3;
            dy += diffY / dist * 3;
        }
    }

    // this is what keeps the crumbgeek inbounds so dont delete this
    gx = Math.min(Math.max(gx + dx, 0), window.innerWidth - 80);
    gy = Math.min(Math.max(gy + dy, 0), window.innerHeight - 80);

    guy.style.left = gx + "px";
    guy.style.top  = gy + "px";
}

setInterval(function(){
   moveZombieTowardTarget("myImg02", 4);
   moveZombieTowardTarget("myImg03", 4.5);

   moveScaredGuy();

   if (document.getElementById('myImg02').style.display != "none" &&
       myHitOther(document.getElementById("myImg01"),document.getElementById('myImg02')))
       playerTakeDamage();

   if (document.getElementById('myImg03').style.display != "none" &&
       myHitOther(document.getElementById("myImg01"),document.getElementById('myImg03')))
       playerTakeDamage();

   checkAmmoPickup();
}, 120);

function moveZombieTowardTarget(id, speed){
    let z = document.getElementById(id);
    if (z.style.display == "none") return;

    let zx = parseFloat(z.style.left);
    let zy = parseFloat(z.style.top);

    let px = parseFloat(myImg01.style.left);
    let py = parseFloat(myImg01.style.top);

    let gx = parseFloat(myImg06.style.left);
    let gy = parseFloat(myImg06.style.top);

    let dxPlayer = px - zx;
    let dyPlayer = py - zy;
    let distPlayer = Math.sqrt(dxPlayer*dxPlayer + dyPlayer*dyPlayer);

    let dxGuy = gx - zx;
    let dyGuy = gy - zy;
    let distGuy = Math.sqrt(dxGuy*dxGuy + dyGuy*dyGuy);

    let targetDx = dxPlayer;
    let targetDy = dyPlayer;

    if (document.getElementById("myImg06").style.display != "none" && distGuy < distPlayer) {
        targetDx = dxGuy;
        targetDy = dyGuy;
    }

    let d = Math.sqrt(targetDx*targetDx + targetDy*targetDy);
    if (d < 1) return;

    z.style.left = zx + (targetDx / d) * speed + "px";
    z.style.top  = zy + (targetDy / d) * speed + "px";

    // Flip zombie
    if (targetDx > 0){
        z.style.transform = "scaleX(-1)";
    } else {
        z.style.transform = "scaleX(1)";
    }
}

</script>

<body id="myBody" style="background-repeat:repeat; background-size: 20%" background="Background1.gif"
onload="updateHealthDisplay(); updateAmmoDisplay(); randomizeZombiePositions();"

onkeydown="{
   lastPlayerLeft = parseInt(myImg01.style.left)
   lastPlayerTop  = parseInt(myImg01.style.top)

   if (event.code == 'Space') {
      event.preventDefault()
      fireBullet()
   }

   if (event.key == 'd') {
      lastDirection='right'
      myImg01.style.transform = 'scaleX(1)'
      myImg01.style.left = lastPlayerLeft + 10 + 'px'
   }
   if (event.key == 'a') {
      lastDirection='left'
      myImg01.style.transform = 'scaleX(-1)'
      myImg01.style.left = lastPlayerLeft - 10 + 'px'
   }
   if (event.key == 's') {
      lastDirection='down'
      myImg01.style.top = lastPlayerTop + 10 + 'px'
   }
   if (event.key == 'w') {
      lastDirection='up'
      myImg01.style.top = lastPlayerTop - 10 + 'px'
   }

   checkExitDoor()
}"

<br>

<div id="healthDisplay" style="font-size:24px; font-weight:bold; color:red;"></div>
<div id="ammoDisplay" style="font-size:24px; font-weight:bold; color:orange;"></div>

<input id="myText01" type=text value="" size=50 placeholder="Feedback here"><br>

<input type=button value="Auto Background Left" onclick="{
  clearInterval(myClock)
  myClock = setInterval(function(){
      myGlobalX -= 5
      myBody.style.backgroundPosition = myGlobalX + 'px 0px'
  }, 100)
}">

<input type=button value="W" onclick="{ lastDirection='up'; myImg01.style.top=parseInt(myImg01.style.top)-10+'px'; checkExitDoor() }">
<input type=button value="A" onclick="{ lastDirection='left'; myImg01.style.transform = 'scaleX(-1)'; myImg01.style.left=parseInt(myImg01.style.left)-10+'px'; checkExitDoor() }">
<input type=button value="S" onclick="{ lastDirection='down'; myImg01.style.top=parseInt(myImg01.style.top)+10+'px'; checkExitDoor() }">
<input type=button value="D" onclick="{ lastDirection='right'; myImg01.style.transform = 'scaleX(1)'; myImg01.style.left=parseInt(myImg01.style.left)+10+'px'; checkExitDoor() }">

<input type=button value="shoot" onclick="fireBullet()"><br><br>

<img id="myImg01" src="olddudewitgun.gif"
style="position:absolute; width:100px; height:80px; left:10px; top:190px; z-index:2; transform: scaleX(1);">

<img id="myImg02" src="Zombie1.gif"
style="position:absolute; width:100px; height:80px; left:350px; top:190px; z-index:1">

<img id="myImg03" src="Zombie2.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:190px; z-index:1">

<img id="myImg04" src="Exitdoor.gif"
style="position:absolute; width:100px; height:80px; left:1700px; top:600px;">

<div id="myBullet"
style="position:absolute; width:12px; height:12px; background:yellow;
left:-200px; top:-200px; display:none; z-index:9999;">
</div>

<img id="myImg05" src="Ammunition1.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:600px; z-index:0">

<img id="myImg06" src="Scaredguy1.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:600px;">

</body>
