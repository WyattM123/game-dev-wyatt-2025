<h1>t2-final-level3-wyatt.html</h1>

<script>

let myGlobalX = 0
let myClock
let myScore = 10
let lastDirection = "right"

let bulletActive = false
let bulletTimer = null
let bulletDX = 0
let bulletDY = 0
let canShoot = true
let shootCooldown = 400

var zombie1HP = 2
var zombie2HP = 2
var zombie3HP = 1

let playerHP = 10
let canTakeDamage = true

let ammo = 12
let maxAmmo = 24

function updateHealthDisplay(){
   document.getElementById("healthDisplay").innerHTML = "Health: " + playerHP
}

function updateAmmoDisplay(){
   document.getElementById("ammoDisplay").innerHTML = "Ammo: " + ammo + " / " + maxAmmo
}

function playerTakeDamage(){
   if (!canTakeDamage) return

   playerHP -= 1
   updateHealthDisplay()
   canTakeDamage = false

   let r = document.getElementById("myImg01").getBoundingClientRect()
   spawnHitParticle(r.left + 40, r.top + 30)

   setTimeout(function(){
      canTakeDamage = true
   }, 1000)

   if (playerHP <= 0){
      alert("Game Over")
      location.reload()
   }
}

function myHitOther(my1,my2){
   let A = document.getElementById(my1).getBoundingClientRect()
   let B = document.getElementById(my2).getBoundingClientRect()

   return !(
      A.right < B.left ||
      A.left > B.right ||
      A.bottom < B.top ||
      A.top > B.bottom
   )
}

function spawnHitParticle(x,y){
   let p = document.createElement("div")
   p.style.position = "absolute"
   p.style.left = x + "px"
   p.style.top  = y + "px"
   p.style.width = "20px"
   p.style.height = "20px"
   p.style.background = "red"
   p.style.borderRadius = "50%"
   p.style.opacity = "1"
   p.style.zIndex = 9999
   p.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out"
   document.body.appendChild(p)

   setTimeout(function(){
      p.style.opacity = "0"
      p.style.transform = "scale(2)"
   }, 10)

   setTimeout(function(){
      p.remove()
   }, 450)
}

function resetBullet(){
   clearInterval(bulletTimer)
   bulletTimer = null
   document.getElementById('myBullet').style.left = "-200px"
   document.getElementById('myBullet').style.top  = "-200px"
   document.getElementById('myBullet').style.display = "none"
   bulletActive = false
}

function checkExitDoor(){
   if (myHitOther('myImg01','myImg04')){
      document.all.myText01.value = "Made it out... For now"
      alert("Next level")
      location = "https://www.google.ca"
   }
}

function hitZombie(zombieID, hpVarName){
   let z = document.getElementById(zombieID)
   let rect = z.getBoundingClientRect()
   spawnHitParticle(rect.left + 40, rect.top + 30)

   window[hpVarName] -= 1

   if (window[hpVarName] <= 0){
      z.style.display = "none"
      document.all.myText01.value = zombieID + " shot dead"
   } else {
      document.all.myText01.value = zombieID + " shot"
   }
}

function fireBullet(){

   clearInterval(bulletTimer)   // âœ… prevents speed stacking

   if (!canShoot || ammo <= 0) return

   ammo -= 1
   updateAmmoDisplay()

   canShoot = false
   setTimeout(() => canShoot = true, shootCooldown)

   bulletActive = true

   let b = document.getElementById('myBullet')
   let g = document.getElementById('myImg01')

   let gx = parseInt(g.style.left)
   let gy = parseInt(g.style.top)

   b.style.left = gx + 45 + "px"
   b.style.top  = gy + 35 + "px"
   b.style.display = "block"

   // ðŸ”’ lock direction once
   bulletDX = 0
   bulletDY = 0
   if (lastDirection == "right") bulletDX = 10
   if (lastDirection == "left")  bulletDX = -10
   if (lastDirection == "up")    bulletDY = -10
   if (lastDirection == "down")  bulletDY = 10

   bulletTimer = setInterval(function(){

      let bx = parseInt(b.style.left)
      let by = parseInt(b.style.top)

      bx += bulletDX
      by += bulletDY

      b.style.left = bx + "px"
      b.style.top  = by + "px"

      if (document.getElementById('myImg02').style.display != "none" &&
          myHitOther('myBullet','myImg02')){
         hitZombie("myImg02", "zombie1HP")
         resetBullet()
      }

      if (document.getElementById('myImg03').style.display != "none" &&
          myHitOther('myBullet','myImg03')){
         hitZombie("myImg03", "zombie2HP")
         resetBullet()
      }

      if (document.getElementById('myImg06').style.display != "none" &&
          myHitOther('myBullet','myImg06')){
         hitZombie("myImg06", "zombie3HP")
         resetBullet()
      }

      if (bx < -20 || bx > 2000 || by < -20 || by > 2000){
         resetBullet()
      }

   }, 20)
}

function randomizeZombiePositions(){
   let minX = 200, maxX = 800
   let minY = 100, maxY = 400

   ;["myImg02","myImg03","myImg06"].forEach(id=>{
      let z = document.getElementById(id)
      z.style.left = Math.random()*(maxX-minX)+minX+"px"
      z.style.top  = Math.random()*(maxY-minY)+minY+"px"
   })
}

function checkAmmoPickup(){
   let a = document.getElementById("myImg05")
   if (a.style.display !== "none" && myHitOther("myImg01","myImg05")){
      ammo = Math.min(ammo + 6, maxAmmo)
      updateAmmoDisplay()
      a.style.display = "none"
   }
}

setInterval(function(){
   moveZombieTowardPlayer("myImg02", 2)
   moveZombieTowardPlayer("myImg03", 2.5)
   moveZombieTowardPlayer("myImg06", 6.5)

   if (myHitOther("myImg01","myImg02")) playerTakeDamage()
   if (myHitOther("myImg01","myImg03")) playerTakeDamage()
   if (myHitOther("myImg01","myImg06")) playerTakeDamage()

   checkAmmoPickup()
}, 120)

function moveZombieTowardPlayer(id, speed){
   let z = document.getElementById(id)
   if (z.style.display == "none") return

   let p = document.getElementById("myImg01")
   let dx = parseFloat(p.style.left) - parseFloat(z.style.left)
   let dy = parseFloat(p.style.top)  - parseFloat(z.style.top)
   let d = Math.sqrt(dx*dx + dy*dy)
   if (d < 1) return

   z.style.left = parseFloat(z.style.left) + dx/d*speed + "px"
   z.style.top  = parseFloat(z.style.top)  + dy/d*speed + "px"
}

</script>

<body id="myBody" style="background-repeat:repeat; background-size: 20%" background="Background2.gif"
onload="updateHealthDisplay(); updateAmmoDisplay(); randomizeZombiePositions();"

onkeydown="{
   if (event.key == 'd') { lastDirection='right'; myImg01.style.left=parseInt(myImg01.style.left)+10+'px' }
   if (event.key == 'a') { lastDirection='left';  myImg01.style.left=parseInt(myImg01.style.left)-10+'px' }
   if (event.key == 's') { lastDirection='down';  myImg01.style.top =parseInt(myImg01.style.top )+10+'px' }
   if (event.key == 'w') { lastDirection='up';    myImg01.style.top =parseInt(myImg01.style.top )-10+'px' }
   checkExitDoor()
}">
<br>

<div id="healthDisplay" style="font-size:24px; font-weight:bold; color:red;"></div>
<div id="ammoDisplay" style="font-size:24px; font-weight:bold; color:orange;"></div>

<input id="myText01" type=text value="" size=50 placeholder="Feedback here"><br>

<input type=button value="Auto Background Left" onclick="{
  clearInterval(myClock)
  myClock = setInterval(function(){
      myGlobalX -= 5
      myBody.style.backgroundPosition = myGlobalX + 'px 0px'
  }, 100)
}">

<input type=button value="W" onclick="{ lastDirection='up'; myImg01.style.top=parseInt(myImg01.style.top)-10+'px'; checkExitDoor() }">
<input type=button value="A" onclick="{ lastDirection='left'; myImg01.style.left=parseInt(myImg01.style.left)-10+'px'; checkExitDoor() }">
<input type=button value="S" onclick="{ lastDirection='down'; myImg01.style.top=parseInt(myImg01.style.top)+10+'px'; checkExitDoor() }">
<input type=button value="D" onclick="{ lastDirection='right'; myImg01.style.left=parseInt(myImg01.style.left)+10+'px'; checkExitDoor() }">

<input type=button value="shoot" onclick="fireBullet()"><br><br>

<img id="myImg01" src="olddudewitgun.gif"
style="position:absolute; width:100px; height:80px; left:10px; top:190px;">

<img id="myImg02" src="Zombie1.gif"
style="position:absolute; width:100px; height:80px; left:350px; top:190px;">

<img id="myImg03" src="Zombie2.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:190px;">

<img id="myImg06" src="Zombie3.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:190px;">

<img id="myImg04" src="Exitdoor.gif"
style="position:absolute; width:100px; height:80px; left:1500px; top:600px;">

<img id="myImg07" src="Banner.gif"
style="position:absolute; width:200px; height:160px; left:1200px; top:700px;">

<img id="myImg08" src="Metalchair.gif"
style="position:absolute; width:100px; height:80px; left:800px; top:600px;">

<div id="myBullet"
style="position:absolute; width:12px; height:12px; background:yellow;
left:-200px; top:-200px; display:none; z-index:9999;">
</div>

<img id="myImg05" src="Ammunition1.gif"
style="position:absolute; width:100px; height:80px; left:500px; top:600px;">

</body>
