<h1>t2-final-level3-wyatt.html</h1>
<b style="color:green; background-color:darkgreen;">Objective: Find Key then leave</b>

<script>
let myGlobalX = 0
let myClock
let myScore = 10
let lastDirection = "right"

let canShoot = true
let shootCooldown = 400
let bullets = []

var zombie1HP = 2
var zombie2HP = 2
var zombie3HP = 1

let playerHP = 10

let ammo = 3
let maxAmmo = 24

let zombies = {
   myImg02: { damage: 1, cooldown: 1000, canAttack: true },
   myImg03: { damage: 1, cooldown: 1500, canAttack: true },
   myImg06: { damage: 2, cooldown: 2000, canAttack: true }
}

let zombieAI = {
   myImg02: { mode: "chase", side: 1 },
   myImg03: { mode: "chase", side: -1 },
   myImg06: { mode: "chase", side: 1 }
}

let keyDropped = false
let keyZombieID = ["myImg02","myImg03","myImg06"][Math.floor(Math.random()*3)]

let lastPlayerLeft = 10
let lastPlayerTop  = 190

function spawnKey(x, y){
   if (keyDropped) return
   keyDropped = true
   myImg07.style.left = x + "px"
   myImg07.style.top  = y + "px"
   myImg07.style.display = "block"
}

function checkKeyPickup(){
   if (myImg07.style.display != "none" && myHitOther(myImg01, myImg07)){
      myImg07.style.display = "none"
      myImg11.style.display = "none"
      document.all.myText01.value = "Da door unlocked"
   }
}

function updateHealthDisplay(){
   document.getElementById("healthDisplay").innerHTML = "Health: " + playerHP
}

function updateAmmoDisplay(){
   document.getElementById("ammoDisplay").innerHTML = "Ammo: " + ammo + " / " + maxAmmo
}

function playerTakeDamage(amount){
   playerHP -= amount
   updateHealthDisplay()

   let r = myImg01.getBoundingClientRect()
   spawnHitParticle(r.left + 40, r.top + 30)

   if (playerHP <= 0){
      alert("Game Over")
      location.reload()
   }
}

function zombieAttack(zombieID){
   let zData = zombies[zombieID]
   if (!zData || !zData.canAttack) return

   playerTakeDamage(zData.damage)
   zData.canAttack = false
   setTimeout(() => zData.canAttack = true, zData.cooldown)
}

function myHitOther(el1, el2){
   let A = el1.getBoundingClientRect()
   let B = el2.getBoundingClientRect()
   return !(
      A.right < B.left ||
      A.left > B.right ||
      A.bottom < B.top ||
      A.top > B.bottom
   )
}

function spawnHitParticle(x,y){
   let p = document.createElement("div")
   p.style.position = "absolute"
   p.style.left = x + "px"
   p.style.top  = y + "px"
   p.style.width = "20px"
   p.style.height = "20px"
   p.style.background = "red"
   p.style.borderRadius = "50%"
   p.style.opacity = "1"
   p.style.zIndex = 9999
   p.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out"
   document.body.appendChild(p)

   setTimeout(() => {
      p.style.opacity = "0"
      p.style.transform = "scale(2)"
   }, 10)

   setTimeout(() => p.remove(), 450)
}

function blockPlayerIfHit(){
   if (
      myHitOther(myImg01, myImg08) ||
      myHitOther(myImg01, myImg10) ||
      myHitOther(myImg01, myImg11)
   ){
      myImg01.style.left = lastPlayerLeft + "px"
      myImg01.style.top  = lastPlayerTop  + "px"
   }
}

function zombieHitWall(zombie){
   return (
      myHitOther(zombie, myImg08) ||
      myHitOther(zombie, myImg10) ||
      myHitOther(zombie, myImg11)
   )
}

function checkExitDoor(){
   if (myHitOther(myImg01,myImg04)){
      document.all.myText01.value = "Made it out... For now"
      alert("Next level")
      location = "https://www.google.ca"
   }
}

function hitZombie(zombieID, hpVarName){
   let z = document.getElementById(zombieID)
   let rect = z.getBoundingClientRect()
   spawnHitParticle(rect.left + 40, rect.top + 30)

   window[hpVarName]--

   if (window[hpVarName] <= 0){
      if (zombieID === keyZombieID){
         spawnKey(rect.left + 30, rect.top + 30)
         document.all.myText01.value = zombieID + " had a key on him"
      } else {
         document.all.myText01.value = zombieID + " shot dead"
      }
      z.style.display = "none"
   } else {
      document.all.myText01.value = zombieID + " shot"
   }
}

function fireBullet(){
   if (!canShoot || ammo <= 0) return

   ammo--
   updateAmmoDisplay()

   canShoot = false
   setTimeout(() => canShoot = true, shootCooldown)

   let b = document.createElement("div")
   b.style.position = "absolute"
   b.style.width = "12px"
   b.style.height = "12px"
   b.style.background = "yellow"
   b.style.zIndex = 9999

   let gx = parseInt(myImg01.style.left)
   let gy = parseInt(myImg01.style.top)

   b.style.left = gx + 45 + "px"
   b.style.top  = gy + 35 + "px"

   document.body.appendChild(b)

   let dx = 0, dy = 0
   if (lastDirection == "right") dx = 10
   if (lastDirection == "left")  dx = -10
   if (lastDirection == "up")    dy = -10
   if (lastDirection == "down")  dy = 10

   let bulletObj = {el: b, dx: dx, dy: dy, interval: null}

   bulletObj.interval = setInterval(() => {
      let bx = parseInt(b.style.left) + dx
      let by = parseInt(b.style.top) + dy
      b.style.left = bx + "px"
      b.style.top  = by + "px"

      if (myImg02.style.display != "none" && myHitOther(b,myImg02)){
         hitZombie("myImg02","zombie1HP")
         removeBullet(bulletObj)
      }
      if (myImg03.style.display != "none" && myHitOther(b,myImg03)){
         hitZombie("myImg03","zombie2HP")
         removeBullet(bulletObj)
      }
      if (myImg06.style.display != "none" && myHitOther(b,myImg06)){
         hitZombie("myImg06","zombie3HP")
         removeBullet(bulletObj)
      }

      if (bx < -20 || bx > 2000 || by < -20 || by > 2000){
         removeBullet(bulletObj)
      }
      if (myImg08.style.display != "none" && myHitOther(b,myImg08)) removeBullet(bulletObj)
      if (myImg10.style.display != "none" && myHitOther(b,myImg10)) removeBullet(bulletObj)
      if (myImg11.style.display != "none" && myHitOther(b,myImg11)) removeBullet(bulletObj)
   }, 20)

   bullets.push(bulletObj)
}

function removeBullet(bulletObj){
   clearInterval(bulletObj.interval)
   bulletObj.el.remove()
   bullets = bullets.filter(b => b !== bulletObj)
}

function randomizeZombiePositions(){
   let minX = 200, maxX = 800
   let minY = 100, maxY = 400

   ;["myImg02","myImg03","myImg06"].forEach(id => {
      let z = document.getElementById(id)
      z.style.left = Math.random()*(maxX-minX)+minX+"px"
      z.style.top  = Math.random()*(maxY-minY)+minY+"px"
   })
}

function checkAmmoPickup(){
   if (myImg05.style.display != "none" && myHitOther(myImg01,myImg05)){
      ammo = Math.min(ammo + 6, maxAmmo)
      updateAmmoDisplay()
      myImg05.style.display = "none"
      document.all.myText01.value = "Picked up ammo"
   }
}

function moveZombieTowardPlayer(id, speed){
   let z = document.getElementById(id)
   if (z.style.display == "none") return

   let ai = zombieAI[id]

   let oldX = parseFloat(z.style.left)
   let oldY = parseFloat(z.style.top)

   let px = parseFloat(myImg01.style.left)
   let py = parseFloat(myImg01.style.top)

   let dx = px - oldX
   let dy = py - oldY
   let d = Math.sqrt(dx*dx + dy*dy)
   if (d < 1) return

   let vx = Math.sign(dx) * speed
   let vy = Math.sign(dy) * speed

   if (ai.mode === "chase"){
      // try X move
      z.style.left = oldX + vx + "px"
      if (zombieHitWall(z)){
         z.style.left = oldX + "px"
         ai.mode = "wall"
         ai.side = Math.random() < 0.5 ? 1 : -1
         return
      }
      // try Y move
      z.style.top = oldY + vy + "px"
      if (zombieHitWall(z)){
         z.style.top = oldY + "px"
         ai.mode = "wall"
         ai.side = Math.random() < 0.5 ? 1 : -1
         return
      }
   } else if (ai.mode === "wall"){
      let wx = ai.side === 1 ? speed : -speed
      z.style.left = oldX + wx + "px"
      if (!zombieHitWall(z)) return
      z.style.left = oldX + "px"
      z.style.top  = oldY + wx + "px"
      if (!zombieHitWall(z)) return
      z.style.top = oldY + "px"
      ai.side *= -1
   }

   z.style.transform = dx > 0 ? "scaleX(-1)" : "scaleX(1)"
}

setInterval(function(){
   moveZombieTowardPlayer("myImg02",2)
   moveZombieTowardPlayer("myImg03",2.5)
   moveZombieTowardPlayer("myImg06",6.5)

   if (myImg02.style.display != "none" && myHitOther(myImg01,myImg02)) zombieAttack("myImg02")
   if (myImg03.style.display != "none" && myHitOther(myImg01,myImg03)) zombieAttack("myImg03")
   if (myImg06.style.display != "none" && myHitOther(myImg01,myImg06)) zombieAttack("myImg06")

   checkAmmoPickup()
   checkKeyPickup()
}, 120)
</script>

<body
id="myBody"
style="background-repeat:repeat; background-size:20%"
background="Background2.gif"
onload="updateHealthDisplay(); updateAmmoDisplay(); randomizeZombiePositions();"

onkeydown="{
   lastPlayerLeft = parseInt(myImg01.style.left)
   lastPlayerTop  = parseInt(myImg01.style.top)

   if (event.code == 'Space') {
      event.preventDefault()
      fireBullet()
   }

   if (event.key == 'd') {
      lastDirection='right'
      myImg01.style.transform = 'scaleX(1)'
      myImg01.style.left = lastPlayerLeft + 10 + 'px'
   }
   if (event.key == 'a') {
      lastDirection='left'
      myImg01.style.transform = 'scaleX(-1)'
      myImg01.style.left = lastPlayerLeft - 10 + 'px'
   }
   if (event.key == 's') {
      lastDirection='down'
      myImg01.style.top = lastPlayerTop + 10 + 'px'
   }
   if (event.key == 'w') {
      lastDirection='up'
      myImg01.style.top = lastPlayerTop - 10 + 'px'
   }

   blockPlayerIfHit()
   checkExitDoor()
}">

<div id="healthDisplay" style="font-size:24px;font-weight:bold;color:red;"></div>
<div id="ammoDisplay" style="font-size:24px;font-weight:bold;color:orange;"></div>

<input id="myText01" type=text size=50 placeholder="Feedback here"><br>
<input type=button value="Shoot (Space)" onclick="fireBullet()"><br><br>

<img id="myImg01" src="olddudewitgun.gif" style="position:absolute;width:100px;height:80px;left:10px;top:190px;">
<img id="myImg02" src="Zombie1.gif" style="position:absolute;width:100px;height:80px;">
<img id="myImg03" src="Zombie2.gif" style="position:absolute;width:100px;height:80px;">
<img id="myImg06" src="Zombie3.gif" style="position:absolute;width:100px;height:80px;">
<img id="myImg04" src="Exitdoor.gif" style="position:absolute;width:100px;height:80px;left:1500px;top:190px;">
<img id="myImg05" src="Ammunition1.gif" style="position:absolute;width:100px;height:80px;left:700px;top:800px;">
<img id="myImg07" src="Key.gif" style="position:absolute;width:100px;height:80px;display:none;">
<img id="myImg08" src="Lightwall.png" style="position:absolute;width:50px;height:500px;left:1300px;top:0px;">
<img id="myImg10" src="Lightwall.png" style="position:absolute;width:50px;height:500px;left:1300px;top:600px;">
<img id="myImg09" src="Banner.gif" style="position:absolute;width:400px;height:320px;left:800px;top:700px;">
<img id="myImg11" src="door.png" style="position:absolute;width:80px;height:100px;left:1290px;top:500px;">
</body>
