<h1>t2-final-level4-wyatt.html</h1>
<b style="color:green; background-color:darkgreen;">Objective: Survive the onslaught</b>

<script>
let myGlobalX = 0
let myClock
let myScore = 10
let lastDirection = "right"

let canShoot = true
let shootCooldown = 400
let bullets = []

var zombie1HP = 2
var zombie2HP = 2
var zombie3HP = 1

let playerHP = 10

let ammo = 3
let maxAmmo = 24

let zombies = {
   myImg02: { damage: 1, cooldown: 1000, canAttack: true },
   myImg03: { damage: 1, cooldown: 1500, canAttack: true },
   myImg06: { damage: 2, cooldown: 2000, canAttack: true }
}

let zombieAI = {
   myImg02: { mode: "chase", side: 1 },
   myImg03: { mode: "chase", side: -1 },
   myImg06: { mode: "chase", side: 1 }
}

let zombieTemplates = [
   { img: "Zombie1.gif", hp: 2, speed: 2, damage: 1, cooldown: 1000 },
   { img: "Zombie2.gif", hp: 2, speed: 2.5, damage: 1, cooldown: 1500 },
   { img: "Zombie3.gif", hp: 1, speed: 6.5, damage: 2, cooldown: 2000 }
]

let zombieClones = {}
let zombieCloneCounter = 0

let lastPlayerLeft = 10
let lastPlayerTop  = 190

function updateHealthDisplay(){
   document.getElementById("healthDisplay").innerHTML = "Health: " + playerHP
}

function updateAmmoDisplay(){
   document.getElementById("ammoDisplay").innerHTML = "Ammo: " + ammo + " / " + maxAmmo
}

function playerTakeDamage(amount){
   playerHP -= amount
   updateHealthDisplay()

   let r = myImg01.getBoundingClientRect()
   spawnHitParticle(r.left + 40, r.top + 30)

   if (playerHP <= 0){
      alert("Game Over")
      location.reload()
   }
}

function zombieAttack(zombieID){
   let zData = zombies[zombieID]
   if (!zData || !zData.canAttack) return

   playerTakeDamage(zData.damage)
   zData.canAttack = false
   setTimeout(() => zData.canAttack = true, zData.cooldown)
}

function myHitOther(el1, el2){
   let A = el1.getBoundingClientRect()
   let B = el2.getBoundingClientRect()
   return !(A.right < B.left || A.left > B.right || A.bottom < B.top || A.top > B.bottom)
}

function spawnHitParticle(x,y){
   let p = document.createElement("div")
   p.style.position = "absolute"
   p.style.left = x + "px"
   p.style.top  = y + "px"
   p.style.width = "20px"
   p.style.height = "20px"
   p.style.background = "red"
   p.style.borderRadius = "50%"
   p.style.opacity = "1"
   p.style.zIndex = 9999
   p.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out"
   document.body.appendChild(p)

   setTimeout(() => {
      p.style.opacity = "0"
      p.style.transform = "scale(2)"
   }, 10)

   setTimeout(() => p.remove(), 450)
}

function blockPlayerIfHit(){
   if (myHitOther(myImg01, myImg08) || myHitOther(myImg01, myImg10)){
      myImg01.style.left = lastPlayerLeft + "px"
      myImg01.style.top  = lastPlayerTop  + "px"
   }
}

function zombieHitWall(zombie){
   return myHitOther(zombie, myImg08) || myHitOther(zombie, myImg10)
}

function checkExitDoor(){
   if (myHitOther(myImg01,myImg04)){
      alert("Next level")
      location = "https://www.google.ca"
   }
}

function hitZombie(zombieID, hpVarName){
   let z = document.getElementById(zombieID)
   let rect = z.getBoundingClientRect()
   spawnHitParticle(rect.left + 40, rect.top + 30)

   window[hpVarName]--

   if (window[hpVarName] <= 0){
      z.style.display = "none"
   }
}

function fireBullet(){
   if (!canShoot || ammo <= 0) return

   ammo--
   updateAmmoDisplay()

   canShoot = false
   setTimeout(() => canShoot = true, shootCooldown)

   let b = document.createElement("div")
   b.style.position = "absolute"
   b.style.width = "12px"
   b.style.height = "12px"
   b.style.background = "yellow"
   b.style.zIndex = 9999

   let gx = parseInt(myImg01.style.left)
   let gy = parseInt(myImg01.style.top)

   b.style.left = gx + 45 + "px"
   b.style.top  = gy + 35 + "px"
   document.body.appendChild(b)

   let dx=0, dy=0
   if (lastDirection=="right") dx=10
   if (lastDirection=="left") dx=-10
   if (lastDirection=="up") dy=-10
   if (lastDirection=="down") dy=10

   let bulletObj = {el:b, dx, dy, interval:null}

   bulletObj.interval = setInterval(() => {
      b.style.left = parseInt(b.style.left)+dx+"px"
      b.style.top  = parseInt(b.style.top)+dy+"px"

      if (myImg02.style.display!="none" && myHitOther(b,myImg02)){ hitZombie("myImg02","zombie1HP"); removeBullet(bulletObj) }
      if (myImg03.style.display!="none" && myHitOther(b,myImg03)){ hitZombie("myImg03","zombie2HP"); removeBullet(bulletObj) }
      if (myImg06.style.display!="none" && myHitOther(b,myImg06)){ hitZombie("myImg06","zombie3HP"); removeBullet(bulletObj) }

      for (let id in zombieClones){
         let z = document.getElementById(id)
         if (z && myHitOther(b,z)){
            zombieClones[id].hp--
            let r = z.getBoundingClientRect()
            spawnHitParticle(r.left+40, r.top+30)
            if (zombieClones[id].hp <= 0){
               z.remove()
               delete zombieClones[id]
            }
            removeBullet(bulletObj)
            break
         }
      }

   },20)
}

function removeBullet(b){ clearInterval(b.interval); b.el.remove() }

function getRandomOffscreenPosition(){
   let w=window.innerWidth, h=window.innerHeight
   let x,y
   do{
      x=Math.random()*(w+400)-200
      y=Math.random()*(h+400)-200
   }while(x>0&&x<w&&y>0&&y<h)
   return {x,y}
}

function spawnZombieClone(){
   let t = zombieTemplates[Math.floor(Math.random()*zombieTemplates.length)]
   let p = getRandomOffscreenPosition()
   let z = document.createElement("img")
   let id = "zombieClone"+zombieCloneCounter++

   z.id=id
   z.src=t.img
   z.style.position="absolute"
   z.style.width="100px"
   z.style.height="80px"
   z.style.left=p.x+"px"
   z.style.top=p.y+"px"
   z.style.zIndex=3
   document.body.appendChild(z)

   zombieClones[id]={hp:t.hp,speed:t.speed,damage:t.damage,cooldown:t.cooldown,canAttack:true}
}

setInterval(function(){
   moveZombieTowardPlayer("myImg02",2)
   moveZombieTowardPlayer("myImg03",2.5)
   moveZombieTowardPlayer("myImg06",6.5)

   if (myImg02.style.display!="none" && myHitOther(myImg01,myImg02)) zombieAttack("myImg02")
   if (myImg03.style.display!="none" && myHitOther(myImg01,myImg03)) zombieAttack("myImg03")
   if (myImg06.style.display!="none" && myHitOther(myImg01,myImg06)) zombieAttack("myImg06")

   for (let id in zombieClones){
      let z=document.getElementById(id)
      let d=zombieClones[id]
      if(!z) continue

      let zx=parseFloat(z.style.left), zy=parseFloat(z.style.top)
      let px=parseFloat(myImg01.style.left), py=parseFloat(myImg01.style.top)
      let dx=px-zx, dy=py-zy
      let dist=Math.sqrt(dx*dx+dy*dy)
      if(dist<1) continue

      z.style.left=zx+(dx/dist)*d.speed+"px"
      z.style.top =zy+(dy/dist)*d.speed+"px"
      z.style.transform=(px-zx)>0?"scaleX(-1)":"scaleX(1)"

      if(myHitOther(myImg01,z)&&d.canAttack){
         playerTakeDamage(d.damage)
         d.canAttack=false
         setTimeout(()=>d.canAttack=true,d.cooldown)
      }
   }

},120)

setInterval(spawnZombieClone,4000)
</script>

<body
onload="updateHealthDisplay(); updateAmmoDisplay();"
onkeydown="{
   lastPlayerLeft=parseInt(myImg01.style.left)
   lastPlayerTop=parseInt(myImg01.style.top)

   if(event.code=='Space'){event.preventDefault();fireBullet()}
   if(event.key=='d'){lastDirection='right';myImg01.style.left=lastPlayerLeft+10+'px'}
   if(event.key=='a'){lastDirection='left';myImg01.style.left=lastPlayerLeft-10+'px'}
   if(event.key=='s'){lastDirection='down';myImg01.style.top=lastPlayerTop+10+'px'}
   if(event.key=='w'){lastDirection='up';myImg01.style.top=lastPlayerTop-10+'px'}

   blockPlayerIfHit()
}">
<div id="healthDisplay"></div>
<div id="ammoDisplay"></div>

<img id="myImg01" src="olddudewitgun.gif" style="position:absolute;width:100px;height:80px;left:10px;top:190px;">
<img id="myImg02" src="Zombie1.gif" style="position:absolute;width:100px;height:80px;">
<img id="myImg03" src="Zombie2.gif" style="position:absolute;width:100px;height:80px;">
<img id="myImg06" src="Zombie3.gif" style="position:absolute;width:100px;height:80px;">

<img id="myImg04" src="Exitdoor.gif" style="position:absolute;width:100px;height:80px;left:1500px;top:190px;">
<img id="myImg08" src="Wall.png" style="position:absolute;width:50px;height:500px;left:1300px;top:0px;">
<img id="myImg10" src="Wall.png" style="position:absolute;width:50px;height:500px;left:1300px;top:600px;">
</body>
