<h1>t2-final-level4-wyatt.html</h1>
<b style="color:green; background-color:darkgreen;">Objective: Survive the onslaught</b>

<script>
let myClock
let lastDirection = "right"

let canShoot = true
let shootCooldown = 400

let playerHP = 10
let canTakeDamage = true

let ammo = 24
let maxAmmo = 24

let zombies = []
let zombieCounter = 0

function updateHealthDisplay(){
   document.getElementById("healthDisplay").innerHTML = "Health: " + playerHP
}

function updateAmmoDisplay(){
   document.getElementById("ammoDisplay").innerHTML = "Ammo: " + ammo + " / " + maxAmmo
}

function playerTakeDamage(){
   if (!canTakeDamage) return

   playerHP--
   updateHealthDisplay()
   canTakeDamage = false

   let r = document.getElementById("myImg01").getBoundingClientRect()
   spawnHitParticle(r.left + 40, r.top + 30)

   setTimeout(()=> canTakeDamage = true, 1000)

   if (playerHP <= 0){
      alert("Game Over")
      location.reload()
   }
}

function myHitOther(el1, el2){
   let A = el1.getBoundingClientRect()
   let B = el2.getBoundingClientRect()
   return !(A.right < B.left || A.left > B.right || A.bottom < B.top || A.top > B.bottom)
}

function spawnHitParticle(x,y){
   let p = document.createElement("div")
   p.style.position = "absolute"
   p.style.left = x + "px"
   p.style.top  = y + "px"
   p.style.width = "20px"
   p.style.height = "20px"
   p.style.background = "red"
   p.style.borderRadius = "50%"
   p.style.opacity = "1"
   p.style.zIndex = 9999
   p.style.transition = "opacity 0.4s ease-out, transform 0.4s ease-out"
   document.body.appendChild(p)

   setTimeout(()=>{
      p.style.opacity = "0"
      p.style.transform = "scale(2)"
   },10)

   setTimeout(()=> p.remove(),450)
}

/* ---------------- ZOMBIE SYSTEM ---------------- */

function getOffscreenSpawnPosition(){
   const buffer = 80
   const maxDistance = 450

   const vw = window.innerWidth
   const vh = window.innerHeight

   let side = Math.floor(Math.random() * 4)
   let x, y

   if (side === 0){ x = -buffer; y = Math.random() * vh }
   if (side === 1){ x = vw + buffer; y = Math.random() * vh }
   if (side === 2){ x = Math.random() * vw; y = -buffer }
   if (side === 3){ x = Math.random() * vw; y = vh + buffer }

   let px = parseFloat(myImg01.style.left)
   let py = parseFloat(myImg01.style.top)

   x = Math.max(px - maxDistance, Math.min(px + maxDistance, x))
   y = Math.max(py - maxDistance, Math.min(py + maxDistance, y))

   return {x,y}
}

function spawnZombie(hp, speed){
   let z = document.getElementById("zombieTemplate").cloneNode(true)

   zombieCounter++
   z.id = "zombie" + zombieCounter
   z.style.display = "block"

   let pos = getOffscreenSpawnPosition()
   z.style.left = pos.x + "px"
   z.style.top  = pos.y + "px"

   z.dataset.hp = hp
   z.dataset.speed = speed

   document.body.appendChild(z)
   zombies.push(z)
}

function moveZombieTowardPlayer(id,speed){
   let z = document.getElementById(id)
   if (!z) return

   let zx=parseFloat(z.style.left)
   let zy=parseFloat(z.style.top)
   let px=parseFloat(myImg01.style.left)
   let py=parseFloat(myImg01.style.top)

   let dx=px-zx
   let dy=py-zy
   let d=Math.sqrt(dx*dx+dy*dy)
   if (d<1) return

   z.style.left = zx + (dx/d)*speed + "px"
   z.style.top  = zy + (dy/d)*speed + "px"
   z.style.transform = dx>0 ? "scaleX(-1)" : "scaleX(1)"
}

/* Zombie movement + damage */
setInterval(()=>{
   zombies.forEach(z=>{
      if (z.dataset.hp <= 0) return

      moveZombieTowardPlayer(z.id, parseFloat(z.dataset.speed))

      if (myHitOther(myImg01, z)){
         playerTakeDamage()
      }
   })
},120)

/* ---------------- SHOOTING ---------------- */

function fireBullet(){
   if (!canShoot || ammo <= 0) return

   ammo--
   updateAmmoDisplay()
   canShoot = false
   setTimeout(()=> canShoot = true, shootCooldown)

   let b = document.createElement("div")
   b.style.position = "absolute"
   b.style.width = "12px"
   b.style.height = "12px"
   b.style.background = "yellow"
   b.style.zIndex = 9999

   b.style.left = parseInt(myImg01.style.left) + 45 + "px"
   b.style.top  = parseInt(myImg01.style.top)  + 35 + "px"
   document.body.appendChild(b)

   let dx=0, dy=0
   if (lastDirection=="right") dx=10
   if (lastDirection=="left") dx=-10
   if (lastDirection=="up") dy=-10
   if (lastDirection=="down") dy=10

   let interval = setInterval(()=>{
      b.style.left = parseInt(b.style.left) + dx + "px"
      b.style.top  = parseInt(b.style.top)  + dy + "px"

      zombies.forEach(z=>{
         if (z.dataset.hp > 0 && myHitOther(b,z)){
            z.dataset.hp--
            let r = z.getBoundingClientRect()
            spawnHitParticle(r.left + 40, r.top + 30)

            if (z.dataset.hp <= 0){
               z.remove()
            }

            clearInterval(interval)
            b.remove()
         }
      })

      if (parseInt(b.style.left)<-50 || parseInt(b.style.left)>2000 ||
          parseInt(b.style.top)<-50  || parseInt(b.style.top)>2000){
         clearInterval(interval)
         b.remove()
      }
   },20)
}

/* ---------------- SPAWN WAVES ---------------- */

setInterval(()=>{
   spawnZombie(2, 4)
   spawnZombie(4, 2.5)
},3000)

</script>

<body id="myBody"
style="background-repeat:repeat; background-size:20%"
background="Background3.gif"
onload="updateHealthDisplay(); updateAmmoDisplay()"

onkeydown="{
   if (event.code == 'Space') { event.preventDefault(); fireBullet(); }
   if (event.key == 'd') { lastDirection='right'; myImg01.style.transform='scaleX(1)'; myImg01.style.left=parseInt(myImg01.style.left)+10+'px' }
   if (event.key == 'a') { lastDirection='left';  myImg01.style.transform='scaleX(-1)'; myImg01.style.left=parseInt(myImg01.style.left)-10+'px' }
   if (event.key == 's') { lastDirection='down';  myImg01.style.top=parseInt(myImg01.style.top)+10+'px' }
   if (event.key == 'w') { lastDirection='up';    myImg01.style.top=parseInt(myImg01.style.top)-10+'px' }
}">

<br>
<div id="healthDisplay" style="font-size:24px; font-weight:bold; color:red;"></div>
<div id="ammoDisplay" style="font-size:24px; font-weight:bold; color:orange;"></div>

<input id="myText01" type=text size=50 placeholder="Feedback here"><br>
<input type=button value="Shoot (Space)" onclick="fireBullet()"><br><br>

<img id="myImg01" src="olddudewitgun.gif"
style="position:absolute; width:100px; height:80px; left:10px; top:190px;">

<img id="zombieTemplate" src="Zombie1.gif"
style="position:absolute; width:100px; height:80px; display:none;">

</body>
