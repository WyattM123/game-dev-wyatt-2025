<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Async Evolution: Same Task, Different Methods</title>
</head>
<body>

    <h1 align="center">ü¶ä t2a23d-async-await-history-wyatt.html</h1>
    <p>Run the demos below to see how <b>Legacy AJAX (XHR)</b>, <b>Promises (.then)</b>, <b>Async/Await</b>, and newer async patterns all perform the same simple task: fetching JSON data from an API. The output box will show the fetched data.</p>

    <div style="margin-bottom: 20px;">
        <label for="api-url" style="font-weight: bold;">API URL:</label>
        <textarea id="api-url" rows="2" cols="120" style="margin-bottom: 10px;">https://randomfox.ca/floof/</textarea><br>
        
        <button onclick="fetchAjaxXhr()">1. Run Legacy XHR (AJAX)</button>
        <button onclick="fetchPromiseChain()">2. Run Promises (.then)</button>
        <button onclick="fetchAsyncAwait()">3. Run Async/Await</button>
        <button onclick="fetchAsyncIIFE()">4. Run Async IIFE</button>
        <button onclick="fetchPromiseAll()">5. Run Promise.all()</button>
        <button onclick="fetchWithAbort()">6. Run AbortController</button>
        <button onclick="document.getElementById('results').innerHTML = 'Output Cleared...';">Clear Output</button>
    </div>

    <div id="results" style="font-family: monospace; white-space: pre-wrap; padding: 10px; border: 1px solid #ccc; background-color: #f7f7f7;">
        Output Cleared...
    </div>

    <script>
        const output = document.getElementById('results');

        function getApiUrl() {
            return document.getElementById('api-url').value;
        }

        function log(message) {
            output.innerHTML += `${message}\n`;
        }
        
        function logData(data, method) {
            const myJson = JSON.stringify(data, null, 2);
            log(`\n--- ${method} Result ---`);
            output.innerHTML += `<pre>${myJson}</pre>`;
        }

        // --- 1. LEGACY AJAX (XMLHttpRequest) ---
        function fetchAjaxXhr() {
            log("\n--- XMLHttpRequest (XHR) Started ---");
            const url = getApiUrl();
            const xhr = new XMLHttpRequest();

            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        logData(data, "XHR (AJAX)");
                        log("‚úÖ XHR Complete: Requires manual JSON parsing and callback handling.\n------------------------------------------------------\n");
                    } catch (e) {
                        log('‚ùå XHR Error: JSON parsing failed.');
                    }
                } else {
                    log(`‚ùå XHR Error: HTTP status ${xhr.status} for ${url}`);
                }
            };

            xhr.onerror = () => log("‚ùå XHR Error: A network error occurred.");

            xhr.open('GET', url, true);
            xhr.send();
            log(`...XHR request sent to ${url}`);
        }

        // --- 2. PROMISES (Fetch API) ---
        function fetchPromiseChain() {
            log("\n--- Promises (.then) Started ---");
            const url = getApiUrl();
            
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                    return response.json(); 
                })
                .then(data => {
                    logData(data, "Promises (.then)");
                    log("‚úÖ Promises Complete: Solves nesting with .then() chaining.\n------------------------------------------------------\n");
                })
                .catch(error => {
                    log(`‚ùå Promise Error: ${error.message}`);
                });

            log(`...Promise fetch initiated to ${url}`);
        }

        // --- 3. ASYNC/AWAIT ---
        async function fetchAsyncAwait() {
            log("\n--- Async/Await Started ---");
            const url = getApiUrl();
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                const data = await response.json();
                logData(data, "Async/Await");
                log("‚úÖ Async/Await Complete: Reads like synchronous code using try/catch.\n------------------------------------------------------\n");
            } catch (error) {
                log(`‚ùå Async/Await Error: ${error.message}`);
            }

            log(`...Async/Await fetch initiated to ${url}`);
        }

        // --- 4. ASYNC IIFE ---
        function fetchAsyncIIFE() {
            log("\n--- Async IIFE Started ---");
            const url = getApiUrl();

            (async () => {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                    const data = await response.json();
                    logData(data, "Async IIFE");
                    log("‚úÖ Async IIFE Complete: Async logic runs immediately without a named function.\n------------------------------------------------------\n");
                } catch (error) {
                    log(`‚ùå Async IIFE Error: ${error.message}`);
                }
            })();

            log(`...Async IIFE executed for ${url}`);
        }

        // --- 5. PROMISE.ALL ---
        function fetchPromiseAll() {
            log("\n--- Promise.all() Started ---");
            const url = getApiUrl();

            Promise.all([
                fetch(url).then(response => {
                    if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                    return response.json();
                })
            ])
            .then(([data]) => {
                logData(data, "Promise.all()");
                log("‚úÖ Promise.all Complete: Designed for handling multiple async requests in parallel.\n------------------------------------------------------\n");
            })
            .catch(error => {
                log(`‚ùå Promise.all Error: ${error.message}`);
            });

            log(`...Promise.all initiated for ${url}`);
        }

        // --- 6. ABORT CONTROLLER ---
        function fetchWithAbort() {
            log("\n--- AbortController Started ---");
            const url = getApiUrl();
            const controller = new AbortController();
            const signal = controller.signal;

            fetch(url, { signal })
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    logData(data, "AbortController");
                    log("‚úÖ AbortController Complete: Allows request cancellation.\n------------------------------------------------------\n");
                })
                .catch(error => {
                    if (error.name === 'AbortError') {
                        log("‚ö†Ô∏è Fetch aborted by controller.");
                    } else {
                        log(`‚ùå AbortController Error: ${error.message}`);
                    }
                });

            log(`...Fetch with AbortController initiated to ${url}`);
        }

    </script>

</body>
</html>
